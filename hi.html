<%- include("../partials/user/header") %>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="apple-touch-icon.png" rel="apple-touch-icon">
    <link href="favicon.png" rel="icon">
    <meta name="author" content="Nghia Minh Luong">
    <meta name="keywords" content="Default Description">
    <meta name="description" content="Default keyword">
    <title>Home</title>
    <!-- Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Archivo+Narrow:300,400,700%7CMontserrat:300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="plugins/ps-icon/style.css">
    <!-- CSS Library-->
    <link rel="stylesheet" href="plugins/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="plugins/owl-carousel/assets/owl.carousel.css">
    <link rel="stylesheet" href="plugins/jquery-bar-rating/dist/themes/fontawesome-stars.css">
    <link rel="stylesheet" href="plugins/slick/slick/slick.css">
    <link rel="stylesheet" href="plugins/bootstrap-select/dist/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="plugins/Magnific-Popup/dist/magnific-popup.css">
    <link rel="stylesheet" href="plugins/jquery-ui/jquery-ui.min.css">
    <link rel="stylesheet" href="plugins/revolution/css/settings.css">
    <link rel="stylesheet" href="plugins/revolution/css/layers.css">
    <link rel="stylesheet" href="plugins/revolution/css/navigation.css">
    <!-- Custom-->
    <link rel="stylesheet" href="css/style.css">
    <!-- Wishlist Dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="ps-loading">
    <main class="ps-main">
        <div class="ps-banner">
            <div class="rev_slider fullscreenbanner" id="home-banner">
                <ul>
                    <% products.forEach((product, index) => { %>
                        <li class="ps-banner__item" data-index="rs-<%= index + 2972 %>" data-transition="random" data-slotamount="default"
                            data-hideafterloop="0" data-hideslideonmobile="off" data-easein="default" data-easeout="default"
                            data-masterspeed="default" data-thumb="<%= product.productImage[0] %>" data-rotate="0"
                            data-saveperformance="off" data-title="Slide" data-param1="" data-param2="" data-param3=""
                            data-param4="" data-param5="" data-param6="" data-param7="" data-param8="" data-param9=""
                            data-param10="" data-description="">
                            <img src="<%= product.productImage[0] %>" alt="<%= product.productName %>" data-bgposition="center center" data-bgfit="cover"
                                data-bgrepeat="no-repeat" data-bgparallax="5" class="rev-slidebg" data-no-retina>
                            <div class="tp-caption ps-banner__caption" data-x="['center','center','center','center']"
                                data-hoffset="['0','0','0','0']" data-y="['middle','middle','middle','middle']"
                                data-voffset="['-150','-150','-150','-150']" data-width="['770','770','770','770']"
                                data-height="none" data-whitespace="normal" data-type="text" data-responsive_offset="on"
                                data-frames='[{"delay":200,"speed":1000,"frame":"0","from":"y:[100%];z:0;rX:0deg;rY:0;rZ:0;sX:1;sY:1;skX:0;skY:0;opacity:0;","to":"o:1;","ease":"Power2.easeInOut"},{"delay":"wait","speed":300,"frame":"999","to":"auto:auto;","ease":"Power3.easeInOut"}]'
                                data-textAlign="['center','center','center','center']" data-paddingtop="[0,0,0,0]"
                                data-paddingright="[0,0,0,0]" data-paddingbottom="[0,0,0,0]" data-paddingleft="[0,0,0,0]"
                                style="z-index: 5; font-size: 40px; color: #ffffff; font-weight: 900;">
                                <%= product.productName.toUpperCase() %>
                            </div>
                            <div class="tp-caption ps-banner__description" data-x="['center','center','center','center']"
                                data-hoffset="['0','0','0','0']" data-y="['middle','middle','middle','middle']"
                                data-voffset="['-80','-80','-80','-80']" data-width="['770','770','770','770']"
                                data-height="none" data-whitespace="normal" data-type="text" data-responsive_offset="on"
                                data-frames='[{"delay":300,"speed":1000,"frame":"0","from":"y:[100%];z:0;rX:0deg;rY:0;rZ:0;sX:1;sY:1;skX:0;skY:0;opacity:0;","to":"o:1;","ease":"Power2.easeInOut"},{"delay":"wait","speed":300,"frame":"999","to":"auto:auto;","ease":"Power3.easeInOut"}]'
                                data-textAlign="['center','center','center','center']" data-paddingtop="[0,0,0,0]"
                                data-paddingright="[0,0,0,0]" data-paddingbottom="[0,0,0,0]" data-paddingleft="[0,0,0,0]"
                                style="z-index: 6; font-size: 18px; color: #ffffff;">
                                <%= product.description %>
                            </div>
                            <a class="tp-caption ps-btn" href="/productDetails?id=<%= product._id %>" data-x="['center','center','center','center']"
                                data-hoffset="['0','0','0','0']" data-y="['middle','middle','middle','middle']"
                                data-voffset="['0','0','0','0']" data-whitespace="normal" data-type="button"
                                data-responsive_offset="on"
                                data-frames='[{"delay":400,"speed":1000,"frame":"0","from":"y:[100%];z:0;rX:0deg;rY:0;rZ:0;sX:1;sY:1;skX:0;skY:0;opacity:0;","to":"o:1;","ease":"Power2.easeInOut"},{"delay":"wait","speed":300,"frame":"999","to":"auto:auto;","ease":"Power3.easeInOut"}]'
                                data-textAlign="['center','center','center','center']" data-paddingtop="[0,0,0,0]"
                                data-paddingright="[30,30,30,30]" data-paddingbottom="[0,0,0,0]"
                                data-paddingleft="[30,30,30,30]" style="z-index: 7;">Shop Now</a>
                        </li>
                    <% }) %>
                </ul>
            </div>
        </div>

        <style>
            @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

            .carousel {
                position: relative;
                height: 400px;
                overflow: hidden;
                background-color: #F4F4F4;
                padding: 44px;
                border-radius: 30px;
            }

            .carousel .list {
                position: absolute;
                width: 1140px;
                max-width: 90%;
                height: 80%;
                left: 50%;
                transform: translateX(-50%);
            }

            .carousel .list .item {
                position: absolute;
                left: 0%;
                width: 70%;
                height: 100%;
                font-size: 15px;
                transition: left 0.5s, opacity 0.5s, width 0.5s;
            }

            .carousel .list .item:nth-child(n + 6) {
                opacity: 0;
            }

            .carousel .list .item:nth-child(2) {
                z-index: 10;
                transform: translateX(0);
            }

            .carousel .list .item img {
                width: 50%;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                transition: right 1.5s;
                cursor: pointer;
            }

            .carousel .list .item .introduce {
                opacity: 0;
                pointer-events: none;
            }

            .carousel .list .item:nth-child(2) .introduce {
                opacity: 1;
                pointer-events: auto;
                width: 400px;
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                transition: opacity 0.5s;
                font-family: Poppins, sans-serif;
            }

            .carousel .list .item .introduce .title {
                font-size: 1.5em;
                font-weight: 500;
                line-height: 1em;
            }

            .carousel .list .item .introduce .topic {
                font-size: 2.5em;
                font-weight: 500;
            }

            .carousel .list .item .introduce .des {
                font-size: small;
                color: #5559;
            }

            .carousel .list .item .introduce .seeMore {
                font-family: Poppins, sans-serif;
                margin-top: 1.2em;
                padding: 5px 0;
                border: none;
                border-bottom: 1px solid #555;
                background-color: transparent;
                font-weight: bold;
                letter-spacing: 3px;
                transition: background 0.5s;
                cursor: pointer;
                text-decoration: none;
                color: #000;
            }

            .carousel .list .item .introduce .seeMore:hover {
                background: #eee;
            }

            .carousel .list .item:nth-child(1) {
                transform: translateX(-100%) translateY(-5%) scale(1.5);
                filter: blur(30px);
                z-index: 11;
                opacity: 0;
                pointer-events: none;
            }

            .carousel .list .item:nth-child(3) {
                transform: translate(50%, 10%) scale(0.8);
                filter: blur(10px);
                z-index: 9;
            }

            .carousel .list .item:nth-child(4) {
                transform: translate(90%, 20%) scale(0.5);
                filter: blur(30px);
                z-index: 8;
            }

            .carousel .list .item:nth-child(5) {
                transform: translate(120%, 30%) scale(0.3);
                filter: blur(40px);
                opacity: 0;
                pointer-events: none;
            }

            .carousel .list .item:nth-child(2) .introduce .title,
            .carousel .list .item:nth-child(2) .introduce .topic,
            .carousel .list .item:nth-child(2) .introduce .des,
            .carousel .list .item:nth-child(2) .introduce .seeMore {
                opacity: 0;
                animation: showContent 0.5s 1s ease-in-out 1 forwards;
            }

            @keyframes showContent {
                from {
                    transform: translateY(-30px);
                    filter: blur(10px);
                }

                to {
                    transform: translateY(0);
                    opacity: 1;
                    filter: blur(0px);
                }
            }

            .carousel .list .item:nth-child(2) .introduce .topic {
                animation-delay: 1.2s;
            }

            .carousel .list .item:nth-child(2) .introduce .des {
                animation-delay: 1.4s;
            }

            .carousel .list .item:nth-child(2) .introduce .seeMore {
                animation-delay: 1.6s;
            }

            .carousel.next .item:nth-child(1) {
                animation: transformFromPosition2 0.5s ease-in-out 1 forwards;
            }

            @keyframes transformFromPosition2 {
                from {
                    transform: translateX(0);
                    filter: blur(0px);
                    opacity: 1;
                }
            }

            .carousel.next .item:nth-child(2) {
                animation: transformFromPosition3 0.7s ease-in-out 1 forwards;
            }

            @keyframes transformFromPosition3 {
                from {
                    transform: translate(50%, 10%) scale(0.8);
                    filter: blur(10px);
                    opacity: 1;
                }
            }

            .carousel.next .item:nth-child(3) {
                animation: transformFromPosition4 0.9s ease-in-out 1 forwards;
            }

            @keyframes transformFromPosition4 {
                from {
                    transform: translate(90%, 20%) scale(0.5);
                    filter: blur(30px);
                    opacity: 1;
                }
            }

            .carousel.next .item:nth-child(4) {
                animation: transformFromPosition5 1.1s ease-in-out 1 forwards;
            }

            @keyframes transformFromPosition5 {
                from {
                    transform: translate(120%, 30%) scale(0.3);
                    filter: blur(40px);
                    opacity: 0;
                }
            }

            .carousel.prev .list .item:nth-child(5) {
                animation: transformFromPosition4 0.5s ease-in-out 1 forwards;
            }

            .carousel.prev .list .item:nth-child(4) {
                animation: transformFromPosition3 0.7s ease-in-out 1 forwards;
            }

            .carousel.prev .list .item:nth-child(3) {
                animation: transformFromPosition2 0.9s ease-in-out 1 forwards;
            }

            .carousel.prev .list .item:nth-child(2) {
                animation: transformFromPosition1 1.1s ease-in-out 1 forwards;
            }

            @keyframes transformFromPosition1 {
                from {
                    transform: translateX(-100%) translateY(-5%) scale(1.5);
                    filter: blur(30px);
                    opacity: 0;
                }
            }

            .carousel .list .item .detail {
                opacity: 0;
                pointer-events: none;
                font-family: Poppins, sans-serif;
            }

            .carousel.showDetail .list .item:nth-child(3),
            .carousel.showDetail .list .item:nth-child(4) {
                left: 100%;
                opacity: 0;
                pointer-events: none;
            }

            .carousel.showDetail .list .item:nth-child(2) {
                width: 100%;
            }

            .carousel.showDetail .list .item:nth-child(2) .introduce {
                opacity: 0;
                pointer-events: none;
            }

            .carousel.showDetail .list .item:nth-child(2) img {
                width: 40%;
                left: 5%;
                right: auto;
                top: 50%;
                transform: translateY(-50%);
            }

            .carousel.showDetail .list .item:nth-child(2) .detail {
                opacity: 1;
                width: 50%;
                position: absolute;
                right: 5%;
                top: 50%;
                transform: translateY(-50%);
                text-align: left;
                pointer-events: auto;
                padding-left: 20px;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .title {
                font-size: 2em;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .categories {
                margin-top: 10px;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .categories a {
                color: #555;
                text-decoration: none;
                margin-right: 10px;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .price {
                font-size: 1.5em;
                font-weight: bold;
                margin-top: 10px;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .price del {
                color: #999;
                margin-right: 10px;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .title,
            .carousel.showDetail .list .item:nth-child(2) .detail .des,
            .carousel.showDetail .list .item:nth-child(2) .detail .categories,
            .carousel.showDetail .list .item:nth-child(2) .detail .price {
                opacity: 0;
                animation: showContent 0.5s 1s ease-in-out 1 forwards;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .des {
                animation-delay: 1.2s;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .categories {
                animation-delay: 1.4s;
            }

            .carousel.showDetail .list .item:nth-child(2) .detail .price {
                animation-delay: 1.6s;
            }

            .arrows {
                position: absolute;
                bottom: 10px;
                width: 1140px;
                max-width: 90%;
                display: flex;
                justify-content: space-between;
                left: 50%;
                transform: translateX(-50%);
            }

            #prev,
            #next {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-family: monospace;
                border: 1px solid #5555;
                font-size: large;
                bottom: 20%;
                left: 10%;
                background-color: #fff;
                cursor: pointer;
            }

            #next {
                left: unset;
                right: 10%;
            }

            #back {
                position: absolute;
                z-index: 100;
                bottom: 0%;
                left: 50%;
                transform: translateX(-50%);
                border: none;
                border-bottom: 1px solid #555;
                font-family: Poppins, sans-serif;
                font-weight: bold;
                letter-spacing: 3px;
                background-color: transparent;
                padding: 10px;
                transition: opacity 0.5s;
                cursor: pointer;
            }

            .carousel.showDetail #back {
                opacity: 1;
            }

            .carousel.showDetail #prev,
            .carousel.showDetail #next {
                opacity: 0;
                pointer-events: none;
            }

            .carousel::before {
                width: 500px;
                height: 300px;
                content: '';
                background-image: linear-gradient(70deg, #2AC37D);
                position: absolute;
                z-index: -1;
                border-radius: 20% 30% 80% 10%;
                filter: blur(150px);
                top: 50%;
                left: 50%;
                transform: translate(-10%, -50%);
                transition: 1s;
            }

            .carousel.showDetail::before {
                transform: translate(-100%, -50%) rotate(90deg);
                filter: blur(130px);
            }

            @media screen and (max-width: 991px) {
                .carousel .list .item {
                    width: 90%;
                }

                .carousel.showDetail .list .item:nth-child(2) .detail .title {
                    font-size: 1.5em;
                }

                .carousel.showDetail .list .item:nth-child(2) img {
                    width: 50%;
                    left: 5%;
                }

                .carousel.showDetail .list .item:nth-child(2) .detail {
                    width: 45%;
                    right: 5%;
                    padding-left: 10px;
                }
            }

            @media screen and (max-width: 767px) {
                .carousel {
                    height: 500px;
                }

                .carousel .list .item {
                    width: 100%;
                    font-size: 10px;
                }

                .carousel .list {
                    height: 100%;
                }

                .carousel .list .item:nth-child(2) .introduce {
                    width: 50%;
                }

                .carousel .list .item img {
                    width: 40%;
                }

                .carousel.showDetail .list .item:nth-child(2) img {
                    width: 100%;
                    left: 0;
                    top: 30%;
                    transform: translateY(-20%);
                }

                .carousel.showDetail .list .item:nth-child(2) .detail {
                    width: 90%;
                    right: 5%;
                    top: 70%;
                    transform: translateY(-10%);
                    text-align: center;
                    padding-left: 0;
                    backdrop-filter: blur(5px);
                }

                .carousel.showDetail .list .item:nth-child(2) .detail .title {
                    font-size: 1.2em;
                }

                .carousel .list .item:nth-child(2) .introduce .des,
                .carousel.showDetail .list .item:nth-child(2) .detail .des {
                    height: 100px;
                    overflow: auto;
                }
            }
        </style>

        <div class="ps-section--features-product ps-section masonry-root pt-100 pb-100">
            <div class="ps-container">
                <div class="ps-section__header mb-50">
                    <h3 class="ps-section__title" data-mask="features">- Features Products</h3>
                </div>
                <div class="ps-section__content pb-50">
                    <div class="carousel">
                        <div class="list">
                            <% products.forEach(product => { %>
                                <div class="item">
                                    <img src="<%= product.productImage[0] %>" data-detail="/productDetails?id=<%= product._id %>" alt="<%= product.productName %>">
                                    
                                    <div class="introduce">
                                        <div class="title">
                                            <%= product.isNew ? 'NEW ARRIVAL' : (product.salePrice < product.regularPrice ? 'SALE' : '') %>
                                        </div>
                                        <div class="topic"><%= product.productName %></div>
                                        <div class="des">
                                            <%= product.categories ? product.categories.join(', ') : product.description %>
                                        </div>
                                        <a href="/productDetails?id=<%= product._id %>" class="seeMore">SEE MORE    <i class="fa-solid fa-share"></i></a>
                                    </div>
                                    
                                    <div class="detail">
                                        <div class="title"><%= product.productName %></div>
                                        <div class="des">
                                            <%= product.categories ? 'H' + product.categories[0] : product.description %>.
                                        </div>
                                        <div class="categories">
                                            <% (product.categories || []).forEach(category => { %>
                                                <a href="/filter?category=<%= category %>"><%= category %></a>,
                                            <% }) %>
                                        </div>
                                        <div class="price">
                                            <% if (product.salePrice < product.regularPrice) { %>
                                                <del>₹<%= product.regularPrice.toLocaleString('en-IN') %></del>
                                            <% } %>
                                            ₹<%= product.salePrice.toLocaleString('en-IN') %>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        </div>
            
                        <div class="arrows">
                            <button id="prev"><i class="fa-solid fa-backward"></i></button>
                            <button id="next"><i class="fa-solid fa-forward"></i></button>
                            <button id="back">See All </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="ps-section--offer">
            <div class="ps-column"><a class="ps-offer" href="/shop"><img
                        src="https://www.amalgamcollection.com/cdn/shop/files/PorscheSpyder-JamesDeanFigure-PROMO-Front3.4AWIDEEDIT_2000x850_crop_center.jpg?v=1743093047" alt=""></a></div>
            <div class="ps-column"><a class="ps-offer" href="/shop"><img
                        src="https://www.amalgamcollection.com/cdn/shop/files/Heroimagewideedit_0cb9aaa6-2223-46fd-89b5-eb2ccd85cbe9_2000x850_crop_center.jpg?v=1744821507" alt=""></a></div>
        </div>

        <div class="ps-section--sale-off ps-section pt-80 pb-40">
            <div class="ps-container">
                <div class="ps-section__header mb-50">
                    <h3 class="ps-section__title" data-mask="Sale off">- Hot Deal Today</h3>
                </div>
                <div class="ps-section__content">
                    <div class="row">
                        <% if (products && products.length > 0) {
                            const product = products[0]; // Latest product
                        %>
                        <!-- LEFT SIDE: Hot Deal Product -->
                        <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                            <div class="ps-hot-deal" id="hot-deal">
                                <div class="ps-product ps-product--hot-deal">
                                    <div class="ps-product__thumbnail">
                                        <img src="/<%= product.productImage[0] %>" alt="<%= product.productName %>">
                                        <a class="ps-product__overlay" href="/productDetails?id=<%= product._id %>"></a>
                                    </div>
                                    <div class="ps-product__content">
                                        <h4 class="ps-product__title">
                                            <a href="/productDetails?id=<%= product._id %>"><%= product.productName %></a>
                                        </h4>
                                        <p class="ps-product__price">
                                            <% if (product.salePrice < product.regularPrice) { %>
                                                <del>₹<%= product.regularPrice.toLocaleString('en-IN') %></del>
                                            <% } %>
                                            ₹<%= product.salePrice.toLocaleString('en-IN') %>
                                        </p>
                                        <p class="ps-product__category">
                                            Category:
                                            <% 
                                                const categories = product.categories && product.categories.length 
                                                    ? product.categories 
                                                    : ['miniature cars'];
                                                categories.forEach((cat, idx) => { 
                                            %>
                                                <a href="/filter?category=<%= cat %>"><%= cat %></a><%= idx < categories.length - 1 ? ', ' : '' %>
                                            <% }); %>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <!-- RIGHT SIDE: Static Hotspot Area -->
                        <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                            <div class="ps-hotspot">
                                <a class="point first active" href="javascript:;"><i class="fa fa-plus"></i>
                                    <div class="ps-hotspot__content">
                                        <p class="heading">Feature 1</p>
                                        <p><%= product.description %></p>
                                    </div>
                                </a>
                                <a class="point second" href="javascript:;"><i class="fa fa-plus"></i>
                                    <div class="ps-hotspot__content">
                                        <p class="heading">Feature 2</p>
                                        <p>Lightweight cushioning offers comfort and performance with every step.</p>
                                    </div>
                                </a>
                                <a class="point third" href="javascript:;"><i class="fa fa-plus"></i>
                                    <div class="ps-hotspot__content">
                                        <p class="heading">Feature 3</p>
                                        <p>Engineered upper materials increase durability and airflow for optimal performance.</p>
                                    </div>
                                </a>
                                <img src="/<%= product.productImage[1] || product.productImage[0] %>" alt="<%= product.productName %>">
                            </div>
                        </div>
                        <% } else { %>
                            <div class="col-12 text-center">
                                <p>No hot deals available right now!</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="ps-section ps-section--top-sales ps-owl-root pt-80 pb-80">
            <div class="ps-container">
                <div class="ps-section__header mb-50">
                    <div class="row">
                        <div class="col-lg-9 col-md-9 col-sm-12 col-xs-12 ">
                            <h3 class="ps-section__title" data-mask="BEST SALE">- Top Sales</h3>
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12 ">
                            <div class="ps-owl-actions">
                                <a class="ps-prev" href="#"><i class="ps-icon-arrow-right"></i>Prev</a>
                                <a class="ps-next" href="#">Next<i class="ps-icon-arrow-left"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ps-section__content">
                    <div class="ps-owl--colection owl-slider" data-owl-auto="true" data-owl-loop="true"
                        data-owl-speed="5000" data-owl-gap="30" data-owl-nav="false" data-owl-dots="false"
                        data-owl-item="4" data-owl-item-xs="1" data-owl-item-sm="2" data-owl-item-md="3"
                        data-owl-item-lg="4" data-owl-duration="1000" data-owl-mousedrag="on">
                        <% products.forEach(product => { %>
                            <div class="ps-shoes--carousel">
                                <div class="ps-shoe">
                                    <div class="ps-shoe__thumbnail">
                                        <% if (product.isNew) { %>
                                            <div class="ps-badge"><span>New</span></div>
                                        <% } %>
                                        <% if (product.salePrice < product.regularPrice) { %>
                                            <div class="ps-badge ps-badge--sale ps-badge--2nd"><span>-<%= Math.round(((product.regularPrice - product.salePrice) / product.regularPrice) * 100) %>%</span></div>
                                        <% } %>
                                        <a class="ps-shoe__favorite" href="#" onclick="addToWishlist('<%= product._id %>')"><i class="ps-icon-heart"></i></a>
                                        <img src="<%= product.productImage[0] %>" alt="<%= product.productName %>">
                                        <a class="ps-shoe__overlay" href="/productDetails?id=<%= product._id %>"></a>
                                    </div>
                                    <div class="ps-shoe__content">
                                        <div class="ps-shoe__variants">
                                            <div class="ps-shoe__variant normal">
                                                <% for (let j = 0; j < Math.min(product.productImage.length, 4); j++) { %>
                                                    <img src="<%= product.productImage[j] %>" alt="">
                                                <% } %>
                                            </div>
                                            <select class="ps-rating ps-shoe__rating">
                                                <option value="1">1</option>
                                                <option value="1">2</option>
                                                <option value="1">3</option>
                                                <option value="1">4</option>
                                                <option value="2">5</option>
                                            </select>
                                        </div>
                                        <div class="ps-shoe__detail">
                                            <a class="ps-shoe__name" href="/productDetails?id=<%= product._id %>"><%= product.productName %></a>
                                            <p class="ps-shoe__categories">
                                                <% (product.categories || ['miniature cars']).forEach(category => { %>
                                                    <a href="/filter?category=<%= category %>"><%= category %></a>,
                                                <% }) %>
                                            </p>
                                            <span class="ps-shoe__price">
                                                <% if (product.salePrice < product.regularPrice) { %>
                                                    <del>₹<%= product.regularPrice.toLocaleString('en-IN') %></del>
                                                <% } %>
                                                ₹<%= product.salePrice.toLocaleString('en-IN') %>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </div>
            </div>
        </div>

        <div class="ps-features pt-80 pb-80">
            <div class="ps-container">
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 ">
                        <div class="ps-iconbox">
                            <div class="ps-iconbox__header"><i class="ps-icon-delivery"></i>
                                <h3>Free shipping</h3>
                                <p>ON ORDER OVER $199</p>
                            </div>
                            <div class="ps-iconbox__content">
                                <p>Want to track a package? Find tracking information and order details from Your Orders.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 ">
                        <div class="ps-iconbox">
                            <div class="ps-iconbox__header"><i class="ps-icon-money"></i>
                                <h3>100% MONEY BACK.</h3>
                                <p>WITHIN 30 DAYS AFTER DELIVERY.</p>
                            </div>
                            <div class="ps-iconbox__content">
                                <p>You may return most new, unopened items sold within 30 days of delivery for a full refund.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 ">
                        <div class="ps-iconbox">
                            <div class="ps-iconbox__header"><i class="ps-icon-customer-service"></i>
                                <h3>SUPPORT 24/7.</h3>
                                <p>WE CAN HELP YOU ONLINE.</p>
                            </div>
                            <div class="ps-iconbox__content">
                                <p>We offer a 24/7 customer hotline so you’re never alone if you have a question.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="ps-home-testimonial bg--parallax pb-80" data-background="images/background/parallax.jpg">
            <div class="container">
                <div class="owl-slider" data-owl-auto="true" data-owl-loop="true" data-owl-speed="5000" data-owl-gap="0"
                    data-owl-nav="false" data-owl-dots="true" data-owl-item="1" data-owl-item-xs="1"
                    data-owl-item-sm="1" data-owl-item-md="1" data-owl-item-lg="1" data-owl-duration="1000"
                    data-owl-mousedrag="on" data-owl-animate-in="fadeIn" data-owl-animate-out="fadeOut">
                    <div class="ps-testimonial">
                        <div class="ps-testimonial__thumbnail"><img src="images/testimonial/ajsa.png" alt=""><i
                                class="fa fa-quote-left"></i></div>
                        <header>
                            <select class="ps-rating">
                                <option value="1">1</option>
                                <option value="1">2</option>
                                <option value="1">3</option>
                                <option value="1">4</option>
                                <option value="5">5</option>
                            </select>
                            <p>Ajsal - CEO & Founder Invision</p>
                        </header>
                        <footer>
                            <p>“Dessert pudding dessert jelly beans cupcake sweet caramels gingerbread. Fruitcake
                                biscuit
                                cheesecake.
                                Cookie topping sweet muffin pudding tart bear claw sugar plum croissant. “</p>
                        </footer>
                    </div>
                    <div class="ps-testimonial">
                        <div class="ps-testimonial__thumbnail"><img src="images/testimonial/shamveel.png" alt=""><i
                                class="fa fa-quote-left"></i></div>
                        <header>
                            <select class="ps-rating">
                                <option value="1">1</option>
                                <option value="1">2</option>
                                <option value="1">3</option>
                                <option value="1">4</option>
                                <option value="5">5</option>
                            </select>
                            <p>Shamveel - Marketing Specialist</p>
                        </header>
                        <footer>
                            <p>“Dessert pudding dessert jelly beans cupcake sweet caramels gingerbread. Fruitcake
                                biscuit
                                cheesecake.
                                Cookie topping sweet muffin pudding tart bear claw sugar plum croissant. “</p>
                        </footer>
                    </div>
                    <div class="ps-testimonial">
                        <div class="ps-testimonial__thumbnail"><img src="images/testimonial/nijas.png" alt=""><i
                                class="fa fa-quote-left"></i></div>
                        <header>
                            <select class="ps-rating">
                                <option value="1">1</option>
                                <option value="1">2</option>
                                <option value="1">3</option>
                                <option value="1">4</option>
                                <option value="5">5</option>
                            </select>
                            <p>Nijas- Customer service representative</p>
                        </header>
                        <footer>
                            <p>“Dessert pudding dessert jelly beans cupcake sweet caramels gingerbread. Fruitcake
                                biscuit
                                cheesecake.
                                Cookie topping sweet muffin pudding tart bear claw sugar plum croissant. “</p>
                        </footer>
                    </div>
                </div>
            </div>
        </div>

        <div class="ps-subscribe">
            <div class="ps-container">
                <div class="row">
                    <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12 ">
                        <h3><i class="fa fa-envelope"></i>Sign up to Newsletter</h3>
                    </div>
                    <div class="col-lg-5 col-md-7 col-sm-12 col-xs-12 ">
                        <form class="ps-subscribe__form" action="do_action" method="post">
                            <input class="form-control" type="text" placeholder="">
                            <button>Sign up now </button>
                        </form>
                    </div>
                    <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12 ">
                        <p>...and receive <span>$20</span> coupon for first shopping.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wishlist Functionality Script -->
        <script>
            function addToWishlist(productId) {
                console.log("Adding to Wishlist:", productId); // Debugging

                $.ajax({
                    url: '/addToWishlist',
                    method: "POST",
                    data: { productId: productId },
                    success: (response) => {
                        console.log("Server Response:", response); // Debugging

                        if (response.status) {
                            Swal.fire({
                                title: "Added to Wishlist",
                                text: "The Product has been added to your wishlist",
                                icon: "success",
                                timer: 2000
                            });
                        } else {
                            Swal.fire({
                                title: "Already in Wishlist",
                                text: response.message,
                                icon: "info",
                                timer: 2000
                            });
                        }
                    },
                    error: (error) => {
                        console.error("AJAX Error:", error); // Debugging
                        Swal.fire({
                            title: "Error",
                            text: "There was an error adding the product to your wishlist",
                            icon: "error",
                            timer: 2000
                        });
                    }
                });
            }
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Features Products Carousel
                let nextButton = document.getElementById('next');
                let prevButton = document.getElementById('prev');
                let carousel = document.querySelector('.carousel');
                let listHTML = document.querySelector('.carousel .list');
                let seeMoreButtons = document.querySelectorAll('.seeMore');
                let backButton = document.getElementById('back');
                let productImages = document.querySelectorAll('.carousel .list .item img');

                let autoSlideInterval;

                const startAutoSlide = () => {
                    autoSlideInterval = setInterval(() => {
                        if (!carousel.classList.contains('showDetail')) {
                            showSlider('next');
                        }
                    }, 5000);
                };

                const stopAutoSlide = () => {
                    clearInterval(autoSlideInterval);
                };

                nextButton.onclick = function () {
                    stopAutoSlide();
                    showSlider('next');
                    startAutoSlide();
                };

                prevButton.onclick = function () {
                    stopAutoSlide();
                    showSlider('prev');
                    startAutoSlide();
                };

                let unAcceppClick;
                const showSlider = (type) => {
                    nextButton.style.pointerEvents = 'none';
                    prevButton.style.pointerEvents = 'none';

                    carousel.classList.remove('next', 'prev');
                    let items = document.querySelectorAll('.carousel .list .item');
                    if (type === 'next') {
                        listHTML.appendChild(items[0]);
                        carousel.classList.add('next');
                    } else {
                        listHTML.prepend(items[items.length - 1]);
                        carousel.classList.add('prev');
                    }
                    clearTimeout(unAcceppClick);
                    unAcceppClick = setTimeout(() => {
                        nextButton.style.pointerEvents = 'auto';
                        prevButton.style.pointerEvents = 'auto';
                    }, 2000);
                };

                seeMoreButtons.forEach((button) => {
                    button.onclick = function (e) {
                        e.preventDefault();
                        stopAutoSlide();
                        if (carousel.classList.contains('showDetail')) {
                            window.location.href = button.href;
                        } else {
                            carousel.classList.remove('next', `prev`);
                            carousel.classList.add('showDetail');
                        }
                    };
                });

                productImages.forEach((image) => {
                    image.onclick = function () {
                        stopAutoSlide();
                        if (carousel.classList.contains('showDetail')) {
                            window.location.href = image.dataset.detail;
                        } else {
                            carousel.classList.remove('next', 'prev');
                            carousel.classList.add('showDetail');
                        }
                    };
                });

                backButton.onclick = function () {
                    carousel.classList.remove('showDetail');
                    startAutoSlide();
                };

                // Start auto-slider on page load
                startAutoSlide();

                // Hot Deal Today Rotation
                const hotDealContainer = document.getElementById('hot-deal');
                let hotDealProducts = <%- JSON.stringify(typeof hotDealProducts !== 'undefined' ? hotDealProducts : products) %>; // Fallback to products if hotDealProducts is undefined
                let currentHotDealIndex = Math.floor(Math.random() * hotDealProducts.length); // Start with random product

                const updateHotDeal = () => {
                    const product = hotDealProducts[currentHotDealIndex];
                    const discountedPrice = product.salePrice - (product.salePrice * 0.30)
                    hotDealContainer.innerHTML = `
                        <h3>${product.productName}</h3>
                        <p class="ps-hot-deal__price">Only: <span> ₹${Math.floor(discountedPrice).toLocaleString('en-IN')}</span></p>
                        <ul class="ps-countdown" data-time="December 31, 2025 23:59:59">
                            <li><span class="hours"></span><p>Hours</p></li>
                            <li class="divider">:</li>
                            <li><span class="minutes"></span><p>minutes</p></li>
                            <li class="divider">:</li>
                            <li><span class="seconds"></span><p>Seconds</p></li>
                        </ul>
                        <a class="ps-btn" href="/productDetails?id=${product._id}">Order Today<i class="ps-icon-next"></i></a>
                    `;

                    // Update countdown timer
                    const countdown = hotDealContainer.querySelector('.ps-countdown');
                    const endTime = new Date(countdown.dataset.time).getTime();
                    const updateCountdown = () => {
                        const now = new Date().getTime();
                        const distance = endTime - now;
                        if (distance < 0) {
                            countdown.innerHTML = '<li><span>Expired</span></li>';
                            return;
                        }
                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                        countdown.querySelector('.hours').textContent = hours.toString().padStart(2, '0');
                        countdown.querySelector('.minutes').textContent = minutes.toString().padStart(2, '0');
                        countdown.querySelector('.seconds').textContent = seconds.toString().padStart(2, '0');
                    };
                    updateCountdown();
                    setInterval(updateCountdown, 1000);

                    // Move to next product
                    currentHotDealIndex = (currentHotDealIndex + 1) % hotDealProducts.length;
                };

                // Initialize hot deal
                if (hotDealProducts.length > 0) {
                    updateHotDeal();
                    // Rotate hot deal every 24 hours (86400000 ms)
                    setInterval(updateHotDeal, 86400000);
                } else {
                    hotDealContainer.innerHTML = '<p>No hot deals available today.</p>';
                }

                // Ensure Owl Carousel is initialized for Top Sales
                $('.ps-owl--colection').owlCarousel({
                    items: 4,
                    loop: true,
                    margin: 30,
                    nav: false,
                    dots: false,
                    autoplay: true,
                    autoplayTimeout: 5000,
                    responsive: {
                        0: { items: 1 },
                        576: { items: 2 },
                        768: { items: 3 },
                        992: { items: 4 }
                    }
                });
            });
        </script>

    </main>

    <%- include("../partials/user/footer") %>